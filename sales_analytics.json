{
  "tables": {
    "public.sales_analytics": {
      "description": "Sales analytics table containing sales quantities, amounts, profit/loss, and metal weight sold by company, branch, customer, item, and date.",
      "metadata": {
        "version": "2.0",
        "owner": "data_analytics_team",
        "description": "AI-optimized semantic layer for sales analytics chatbot",
        "last_updated": "2026-02-06",
        "verified": true,
        "column_count": 33
      },
      "model": {
        "grain": "company_branch_customer_item_date",
        "grain_description": "One row represents sales data for one company, branch, customer, and item on one date"
      },
      
      "columns": {
        "id": {
          "type": "dimension",
          "description": "Primary key identifier",
          "role": "id",
          "aliases": ["id", "record_id", "sales_id"],
          "aggregation": null,
          "constraints": { "filterable": true, "groupable": false }
        },
        "companycode": {
          "type": "dimension",
          "description": "Company identifier code",
          "role": "code",
          "aliases": ["company_code", "company", "org_code"],
          "aggregation": null,
          "constraints": { "filterable": true, "groupable": true }
        },
        "branchcode": {
          "type": "dimension",
          "description": "Branch identifier code",
          "role": "code",
          "aliases": ["branch_code", "branch", "location_code"],
          "aggregation": null,
          "constraints": { "filterable": true, "groupable": true }
        },
        "customercode": {
          "type": "dimension",
          "description": "Customer identifier code",
          "role": "code",
          "aliases": ["customer_code", "cust_code", "client_code"],
          "aggregation": null,
          "constraints": { "filterable": true, "groupable": true }
        },
        "asondate": {
          "type": "date",
          "description": "As on date for sales analytics snapshot",
          "aliases": ["as_on_date", "date", "snapshot_date", "sales_date", "transaction_date"],
          "aggregation": null,
          "constraints": { "filterable": true, "groupable": true }
        },
        "itemcode": {
          "type": "dimension",
          "description": "Item identifier code",
          "role": "code",
          "aliases": ["item_code", "item", "product_code", "sku", "material_code"],
          "aggregation": null,
          "constraints": { "filterable": true, "groupable": true }
        },
        "make": {
          "type": "dimension",
          "description": "Manufacturer or brand of item",
          "aliases": ["make", "manufacturer"],
          "aggregation": null,
          "constraints": { "filterable": true, "groupable": true }
        },
        "saleqty_ason": {
          "type": "measure",
          "description": "Sales quantity (units sold)",
          "aliases": ["sale_qty", "sales_quantity", "sold_qty", "qty_sold", "quantity", "units", "volume"],
          "aggregation": "sum",
          "format": "number",
          "unit": "units",
          "constraints": { "filterable": false, "groupable": false }
        },
        "saleamt_ason": {
          "type": "measure",
          "description": "Sales amount in INR (Indian Rupees)",
          "aliases": ["sale_amt", "sales_amount", "revenue", "sales_value", "sale_value", "sales", "turnover", "total sales"],
          "aggregation": "sum",
          "format": "currency",
          "unit": "INR",
          "constraints": { "filterable": false, "groupable": false }
        },
        "profitloss_ason": {
          "type": "measure",
          "description": "Profit or loss amount in INR",
          "aliases": ["profit_loss", "pnl", "p&l", "net_profit_loss", "profit", "loss", "earnings", "profitability"],
          "aggregation": "sum",
          "format": "currency",
          "unit": "INR",
          "constraints": { "filterable": false, "groupable": false }
        },
        "metalweightsold_ason": {
          "type": "measure",
          "description": "Metal weight sold in KG",
          "aliases": ["metal_weight_sold", "weight_sold", "metal_wt_sold", "sold_weight", "weight", "metal weight", "tonnage", "kg sold"],
          "aggregation": "sum",
          "format": "number",
          "unit": "KG",
          "constraints": { "filterable": false, "groupable": false }
        },
        "item_receivable": {
          "type": "measure",
          "description": "Outstanding receivables amount in INR",
          "aliases": ["item_receivable", "receivable", "outstanding", "receivable_amount", "dues", "pending payment", "ar", "accounts receivable"],
          "aggregation": "sum",
          "format": "currency",
          "unit": "INR",
          "constraints": { "filterable": false, "groupable": false }
        },
        "companyname": {
          "type": "dimension",
          "description": "Company name",
          "role": "name",
          "aliases": ["company_name", "org_name", "business_unit_name", "company", "organization"],
          "aggregation": null,
          "constraints": { "filterable": true, "groupable": true }
        },
        "branchname": {
          "type": "dimension",
          "description": "Branch name or location name",
          "role": "name",
          "aliases": ["branch_name", "location_name", "branch", "location", "office"],
          "aggregation": null,
          "constraints": { "filterable": true, "groupable": true }
        },
        "customername": {
          "type": "dimension",
          "description": "Customer/Client name",
          "role": "name",
          "aliases": ["customer_name", "cust_name", "client_name", "customer", "client", "buyer", "account"],
          "aggregation": null,
          "constraints": { "filterable": true, "groupable": true }
        },
        "itemname": {
          "type": "dimension",
          "description": "Item/Product name",
          "role": "name",
          "aliases": ["item_name", "product_name", "item_description", "product", "item", "material name", "sku name"],
          "aggregation": null,
          "constraints": { "filterable": true, "groupable": true }
        },
        "catrefno": {
          "type": "dimension",
          "description": "Category reference number",
          "aliases": ["category_ref_no", "cat_ref", "category_reference"],
          "aggregation": null,
          "constraints": { "filterable": true, "groupable": true }
        },
        "industry": {
          "type": "dimension",
          "description": "Industry sector of the customer",
          "aliases": ["industry", "industry_type", "sector", "business_industry", "vertical", "segment"],
          "aggregation": null,
          "constraints": { "filterable": true, "groupable": true }
        },
        "handledbyname": {
          "type": "dimension",
          "description": "Salesperson/Handler name",
          "role": "name",
          "aliases": ["handled_by_name", "handler_name", "salesperson_name", "salesman_name", "handler", "salesperson", "sales person", "sales rep", "se"],
          "aggregation": null,
          "constraints": { "filterable": true, "groupable": true }
        },
        "customer_state": {
          "type": "dimension",
          "description": "Indian state where customer is located",
          "aliases": ["customer_state", "state", "region", "customer_region", "location", "geography", "area", "territory"],
          "aggregation": null,
          "sample_values": ["Maharashtra", "Gujarat", "Karnataka", "Tamil Nadu", "Delhi", "Rajasthan"],
          "constraints": { "filterable": true, "groupable": true }
        },
        "customer_category": {
          "type": "dimension",
          "description": "Category classification of customer",
          "aliases": ["customer_category", "cust_category", "customer_type_category", "category"],
          "aggregation": null,
          "constraints": { "filterable": true, "groupable": true }
        },
        "groupheadname": {
          "type": "dimension",
          "description": "Distributor/Dealer/Group Head name (main sales entity)",
          "role": "name",
          "aliases": ["group_head_name", "group_head", "distributor", "dealer", "partner", "channel partner", "entity", "group", "distributor name"],
          "aggregation": null,
          "constraints": { "filterable": true, "groupable": true }
        },
        "itemgroup": {
          "type": "dimension",
          "description": "Product category/group (Building Wires, LT Cables, etc.)",
          "aliases": ["item_group", "product_group", "main_group", "primary_group", "category", "product category", "product line"],
          "aggregation": null,
          "constraints": { "filterable": true, "groupable": true }
        },
        "itemsubgroup": {
          "type": "dimension",
          "description": "Product subcategory",
          "aliases": ["item_subgroup", "product_subgroup", "sub_group", "secondary_group", "subcategory"],
          "aggregation": null,
          "constraints": { "filterable": true, "groupable": true }
        },
        "period": {
          "type": "dimension",
          "description": "Time period (Month Year format, e.g., 'January 2026')",
          "aliases": ["period", "time_period", "reporting_period", "month", "month year"],
          "aggregation": null,
          "sample_values": ["January 2026", "February 2026", "December 2025"],
          "constraints": { "filterable": true, "groupable": true }
        },
        "regionalheadname": {
          "type": "dimension",
          "description": "Regional Head name (sales hierarchy)",
          "role": "name",
          "aliases": ["regional_head_name", "regional_head", "region_head", "regional_leader", "regional manager", "rm", "area head", "zonal head", "zone head"],
          "aggregation": null,
          "constraints": { "filterable": true, "groupable": true }
        },
        "itembranchcategory": {
          "type": "dimension",
          "description": "Item branch category code",
          "role": "code",
          "aliases": ["item_branch_category", "branch_category_code", "ica_category"],
          "aggregation": null,
          "constraints": { "filterable": true, "groupable": true }
        },
        "itembranchcategoryname": {
          "type": "dimension",
          "description": "Item branch category name",
          "role": "name",
          "aliases": ["item_branch_category_name", "branch_category_name", "ica_category_name"],
          "aggregation": null,
          "constraints": { "filterable": true, "groupable": true }
        },
        "itemnationalcategory": {
          "type": "dimension",
          "description": "Item national category code",
          "role": "code",
          "aliases": ["item_national_category", "national_category_code", "icb_category"],
          "aggregation": null,
          "constraints": { "filterable": true, "groupable": true }
        },
        "itemnationalcategoryname": {
          "type": "dimension",
          "description": "Item national category name",
          "role": "name",
          "aliases": ["item_national_category_name", "national_category_name", "icb_category_name"],
          "aggregation": null,
          "constraints": { "filterable": true, "groupable": true }
        },
        "material": {
          "type": "dimension",
          "description": "Material type (Copper, Aluminium, etc.)",
          "aliases": ["material", "material_type", "material_classification", "raw material", "conductor material"],
          "sample_values": ["Copper", "Aluminium", "CU", "AL"],
          "aggregation": null,
          "constraints": { "filterable": true, "groupable": true }
        },
        "customer_type": {
          "type": "dimension",
          "description": "Type of customer (Regular, Project, etc.)",
          "aliases": ["customer_type", "cust_type", "client_type", "type", "customer classification"],
          "aggregation": null,
          "constraints": { "filterable": true, "groupable": true }
        },
        "brand": {
          "type": "dimension",
          "description": "Brand name of the product",
          "aliases": ["brand", "brand_name", "item_brand", "product brand"],
          "aggregation": null,
          "constraints": { "filterable": true, "groupable": true }
        }
      },
      
      "dimensions": [
        "companycode", "branchcode", "customercode", "itemcode", "make",
        "companyname", "branchname", "customername", "itemname", "catrefno",
        "industry", "handledbyname", "customer_state", "customer_category",
        "groupheadname", "itemgroup", "itemsubgroup", "period", "regionalheadname",
        "itembranchcategory", "itembranchcategoryname", "itemnationalcategory",
        "itemnationalcategoryname", "material", "customer_type", "brand"
      ],
      
      "measures": [
        "saleqty_ason", "saleamt_ason", "profitloss_ason", "metalweightsold_ason", "item_receivable"
      ],
      
      "time_columns": ["asondate", "period"],
      
      "derived_measures": [
        {
          "name": "margin_percent",
          "expression": "ROUND(SUM(profitloss_ason) * 100.0 / NULLIF(SUM(saleamt_ason), 0), 2)",
          "type": "ratio",
          "description": "Profit margin as percentage of sales",
          "aliases": ["margin", "margin %", "profit margin", "margin percentage", "profitability %"]
        },
        {
          "name": "avg_order_value",
          "expression": "ROUND(SUM(saleamt_ason) / NULLIF(SUM(saleqty_ason), 0), 2)",
          "type": "ratio",
          "description": "Average order/transaction value",
          "aliases": ["aov", "average order", "avg transaction", "per unit value"]
        },
        {
          "name": "avg_sales_per_customer",
          "expression": "ROUND(SUM(saleamt_ason) / NULLIF(COUNT(DISTINCT customername), 0), 2)",
          "type": "ratio",
          "description": "Average sales per customer",
          "aliases": ["average sales", "sales per customer", "customer average"]
        },
        {
          "name": "sales_per_kg",
          "expression": "ROUND(SUM(saleamt_ason) / NULLIF(SUM(metalweightsold_ason), 0), 2)",
          "type": "ratio",
          "description": "Sales amount per KG of metal",
          "aliases": ["sales per weight", "rate per kg", "price per kg"]
        },
        {
          "name": "receivables_ratio",
          "expression": "ROUND(SUM(item_receivable) * 100.0 / NULLIF(SUM(saleamt_ason), 0), 2)",
          "type": "ratio",
          "description": "Receivables as percentage of sales",
          "aliases": ["receivable ratio", "credit ratio", "outstanding ratio"]
        }
      ],

      "business_term_mappings": {
        "product_categories": {
          "_description": "CRITICAL: Maps business terms to exact SQL WHERE clauses for product categories",
          "building_wires": {
            "business_term": "Building Wires",
            "sql_expression": "itemgroup LIKE 'CABLES : BUILDING WIRES%'",
            "description": "Building/House wiring cables",
            "aliases": ["building wire", "house wire", "house wiring", "hw", "bw", "building cables", "domestic wire", "housing wire"]
          },
          "lt_cables": {
            "business_term": "LT Cables",
            "sql_expression": "itemgroup = 'CABLES : LT'",
            "description": "Low Tension power cables",
            "aliases": ["lt cable", "low tension", "lt power cable", "ltc", "low tension cable", "lt"]
          },
          "flexibles": {
            "business_term": "Flexibles",
            "sql_expression": "itemgroup = 'CABLES : LDC (FLEX ETC)'",
            "description": "Flexible cables and wires",
            "aliases": ["flexible", "flex", "flexible cable", "ldc", "flexible wire", "submersible cable", "multicore flexible"]
          },
          "ht_ehv_cables": {
            "business_term": "HT & EHV Cables",
            "sql_expression": "itemgroup = 'CABLES : HT & EHV'",
            "description": "High Tension and Extra High Voltage cables",
            "aliases": ["ht cable", "ht cables", "ehv", "high tension", "ht", "ehv cable", "high voltage", "hv cable", "ht power cable", "ht ehv", "ht and ehv"]
          },
          "all_cables": {
            "business_term": "All Cables",
            "sql_expression": "itemgroup LIKE 'CABLES%'",
            "description": "All cable products",
            "aliases": ["cables", "all products", "total", "overall"]
          }
        },
        
        "indian_states": {
          "_description": "Maps state names and abbreviations to correct spelling",
          "maharashtra": { "value": "Maharashtra", "aliases": ["mh"] },
          "gujarat": { "value": "Gujarat", "aliases": ["gj"] },
          "karnataka": { "value": "Karnataka", "aliases": ["ka"] },
          "tamil_nadu": { "value": "Tamil Nadu", "aliases": ["tn", "tamilnadu"] },
          "andhra_pradesh": { "value": "Andhra Pradesh", "aliases": ["ap"] },
          "telangana": { "value": "Telangana", "aliases": ["ts"] },
          "kerala": { "value": "Kerala", "aliases": ["kl"] },
          "rajasthan": { "value": "Rajasthan", "aliases": ["rj"] },
          "madhya_pradesh": { "value": "Madhya Pradesh", "aliases": ["mp"] },
          "uttar_pradesh": { "value": "Uttar Pradesh", "aliases": ["up"] },
          "west_bengal": { "value": "West Bengal", "aliases": ["wb"] },
          "delhi": { "value": "Delhi", "aliases": ["ncr", "new delhi"] },
          "punjab": { "value": "Punjab", "aliases": ["pb"] },
          "haryana": { "value": "Haryana", "aliases": ["hr"] },
          "bihar": { "value": "Bihar", "aliases": ["br"] },
          "odisha": { "value": "Odisha", "aliases": ["orissa", "od"] },
          "jharkhand": { "value": "Jharkhand", "aliases": ["jh"] },
          "chhattisgarh": { "value": "Chhattisgarh", "aliases": ["cg"] },
          "assam": { "value": "Assam", "aliases": ["as"] },
          "goa": { "value": "Goa", "aliases": ["ga"] }
        },
        
        "time_periods": {
          "_description": "Maps time-related terms",
          "months": {
            "january": "January", "jan": "January",
            "february": "February", "feb": "February",
            "march": "March", "mar": "March",
            "april": "April", "apr": "April",
            "may": "May",
            "june": "June", "jun": "June",
            "july": "July", "jul": "July",
            "august": "August", "aug": "August",
            "september": "September", "sep": "September", "sept": "September",
            "october": "October", "oct": "October",
            "november": "November", "nov": "November",
            "december": "December", "dec": "December"
          },
          "special": {
            "ytd": "year_to_date",
            "mtd": "month_to_date",
            "last_month": "previous_month",
            "this_month": "current_month",
            "last_year": "previous_year",
            "this_year": "current_year"
          }
        },
        
        "comparison_operators": {
          "more_than": ">", "greater_than": ">", "above": ">", "over": ">", "exceeding": ">", "higher_than": ">",
          "less_than": "<", "below": "<", "under": "<", "lower_than": "<",
          "equal_to": "=", "exactly": "=", "is": "=",
          "at_least": ">=", "minimum": ">=",
          "at_most": "<=", "maximum": "<=", "up_to": "<=",
          "not": "!=", "except": "!=", "excluding": "!="
        },
        
        "ranking_terms": {
          "top": { "order": "DESC", "type": "best" },
          "best": { "order": "DESC", "type": "best" },
          "highest": { "order": "DESC", "type": "best" },
          "leading": { "order": "DESC", "type": "best" },
          "largest": { "order": "DESC", "type": "best" },
          "bottom": { "order": "ASC", "type": "worst" },
          "worst": { "order": "ASC", "type": "worst" },
          "lowest": { "order": "ASC", "type": "worst" },
          "smallest": { "order": "ASC", "type": "worst" },
          "least": { "order": "ASC", "type": "worst" }
        },
        
        "aggregation_terms": {
          "total": "SUM", "sum": "SUM", "overall": "SUM", "aggregate": "SUM",
          "average": "AVG", "avg": "AVG", "mean": "AVG",
          "count": "COUNT", "number_of": "COUNT", "how_many": "COUNT",
          "max": "MAX", "min": "MIN"
        }
      },

      "llm_config": {
        "system_prompt_template": "You are an expert SQL analyst for a cable manufacturing company's sales database.\nYour task is to convert natural language questions into accurate PostgreSQL queries.\n\nDATABASE: PostgreSQL\nTABLE: sales_analytics\nGRAIN: One row = Sales data for one customer + item + branch + date\n\n{schema_context}\n\nIMPORTANT RULES:\n1. Generate ONLY SELECT queries - no INSERT, UPDATE, DELETE, DROP\n2. ALWAYS use SUM(), AVG(), COUNT() for measures - never return raw measure columns\n3. Use GROUP BY for any dimension in SELECT\n4. Use NULLIF(x, 0) to prevent division by zero\n5. Limit results to 100 rows maximum\n6. Period values are in format \"Month Year\" (e.g., \"January 2026\")\n7. For product categories, use EXACT SQL expressions from the mappings\n8. For margins/percentages, multiply by 100 and use ROUND()\n9. Use ILIKE for case-insensitive text matching\n10. Order results meaningfully (usually by the main metric DESC)\n\nOUTPUT FORMAT:\nReturn ONLY the SQL query. No explanations, no markdown, no comments.",
        
        "user_prompt_template": "CURRENT FILTERS APPLIED (include in WHERE clause):\n{filters}\n\nUSER QUESTION:\n{question}\n\nGenerate the SQL query:",
        
        "answer_format_template": "You are a helpful data analyst assistant.\nFormat the SQL query results into a clear, conversational response.\n\nRULES:\n1. Use natural language, not technical jargon\n2. Format numbers properly:\n   - Currency: ₹X.XX Cr (for crores) or ₹X.XX Lakh (for lakhs)\n   - Percentages: X.X%\n   - Quantities: X,XXX units\n3. Highlight key insights\n4. Keep response concise but informative\n5. If data is empty, say so politely\n6. Use bullet points for lists\n7. Use bold (**text**) for emphasis\n\nORIGINAL QUESTION: {question}\n\nSQL QUERY EXECUTED:\n{sql}\n\nQUERY RESULTS:\n{results}\n\nFormat a helpful response:",
        
        "example_qa_pairs": [
          {
            "question": "Top 5 customers by sales",
            "sql": "SELECT customername, SUM(saleamt_ason) as total_sales FROM sales_analytics GROUP BY customername ORDER BY total_sales DESC LIMIT 5"
          },
          {
            "question": "Total sales in Gujarat for Building Wires",
            "sql": "SELECT SUM(saleamt_ason) as total_sales FROM sales_analytics WHERE customer_state = 'Gujarat' AND itemgroup LIKE 'CABLES : BUILDING WIRES%'"
          },
          {
            "question": "Margin percentage by product category",
            "sql": "SELECT itemgroup, SUM(saleamt_ason) as total_sales, SUM(profitloss_ason) as total_profit, ROUND(SUM(profitloss_ason) * 100.0 / NULLIF(SUM(saleamt_ason), 0), 2) as margin_percent FROM sales_analytics GROUP BY itemgroup ORDER BY total_sales DESC"
          },
          {
            "question": "Compare sales of LT Cables vs Building Wires",
            "sql": "SELECT CASE WHEN itemgroup LIKE 'CABLES : BUILDING WIRES%' THEN 'Building Wires' WHEN itemgroup = 'CABLES : LT' THEN 'LT Cables' END as category, SUM(saleamt_ason) as total_sales, SUM(profitloss_ason) as total_profit FROM sales_analytics WHERE itemgroup LIKE 'CABLES : BUILDING WIRES%' OR itemgroup = 'CABLES : LT' GROUP BY 1 ORDER BY total_sales DESC"
          },
          {
            "question": "Which distributors have negative margin?",
            "sql": "SELECT groupheadname as distributor, SUM(saleamt_ason) as total_sales, SUM(profitloss_ason) as total_profit, ROUND(SUM(profitloss_ason) * 100.0 / NULLIF(SUM(saleamt_ason), 0), 2) as margin_percent FROM sales_analytics GROUP BY groupheadname HAVING SUM(profitloss_ason) < 0 ORDER BY margin_percent ASC LIMIT 20"
          },
          {
            "question": "Sales by state for January 2026",
            "sql": "SELECT customer_state, SUM(saleamt_ason) as total_sales, COUNT(DISTINCT customername) as customer_count FROM sales_analytics WHERE period = 'January 2026' AND customer_state IS NOT NULL GROUP BY customer_state ORDER BY total_sales DESC LIMIT 20"
          },
          {
            "question": "Month wise sales trend",
            "sql": "SELECT period, SUM(saleamt_ason) as total_sales, SUM(profitloss_ason) as total_profit, SUM(saleqty_ason) as total_quantity FROM sales_analytics WHERE period IS NOT NULL GROUP BY period ORDER BY period"
          },
          {
            "question": "Top 10 products by quantity sold",
            "sql": "SELECT itemname as product, SUM(saleqty_ason) as total_quantity, SUM(saleamt_ason) as total_sales FROM sales_analytics GROUP BY itemname ORDER BY total_quantity DESC LIMIT 10"
          }
        ]
      }
    }
  }
}
